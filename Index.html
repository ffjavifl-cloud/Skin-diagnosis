<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Skin Diagnosis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
    h1 { text-align: center; color: #4CAF50; }
    input, button { width: 100%; margin-top: 10px; padding: 10px; }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background: #45a049; }
    .result { margin-top: 20px; }
    .bar { height: 10px; background: #ddd; border-radius: 5px; overflow: hidden; }
    .fill { height: 100%; background: #4CAF50; }
    small { display: block; margin-top: 20px; font-size: 12px; color: #777; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Skin Diagnosis</h1>
    <input type="file" id="foto" accept="image/*">
    <button onclick="analizar()">Analizar piel</button>
    <div id="resultado" class="result"></div>
    <small>⚠ Este análisis es generado por IA y no sustituye la evaluación médica profesional.</small>
  </div>

  <script>
    async function analizar() {
      const file = document.getElementById('foto').files[0];
      if (!file) return alert("Por favor, selecciona una foto.");

      const base64 = await toBase64(file);

      const prompt = `
Analiza la siguiente foto del rostro y evalúa en escala del 1 al 5:
- Arrugas profundas
- Luminosidad
- Líneas finas
- Hiperpigmentación
- Imperfecciones contorno de ojos
Devuelve el resultado en formato JSON con cada parámetro y su puntuación.
`;

      const payload = {
        model: "gpt-4-vision-preview",
        messages: [
          { role: "system", content: "Eres un experto en dermatología estética." },
          { role: "user", content: [
            { type: "text", text: prompt },
            { type: "image_url", image_url: { url: "data:image/jpeg;base64," + base64 } }
          ]}
        ]
      };

      try {
        const response = await fetch("https://TU_API_ENDPOINT", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer TU_API_KEY"
          },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        const output = JSON.parse(result.choices?.[0]?.message?.content || "{}");
        mostrarReporte(output);

      } catch (error) {
        console.error(error);
        alert("Error al procesar la imagen.");
      }
    }

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
      });
    }

    function mostrarReporte(data) {
      let html = "<h2>Reporte de Análisis Cutáneo</h2>";
      for (let key in data) {
        const score = data[key];
        const percent = (score / 5) * 100;
        html += `
          <div><strong>${key}:</strong> ${score}/5
            <div class="bar"><div class="fill" style="width:${percent}%"></div></div>
          </div><br>
        `;
      }
      document.getElementById("resultado").innerHTML = html;
    }
  </script>
</body>
</html>
